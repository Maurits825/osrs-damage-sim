<div class="mx-1" *ngIf="gearInputSetup">
  <div class="row mb-2 justify-content-center">
    <div class="col-auto"><h3 class="text-end">Gear Setup:</h3></div>
    <div class="col-5">
      <input class="form-control" type="text" [(ngModel)]="gearInputSetup.setupName" placeholder="Setup name" />
    </div>
  </div>
  <div class="row mb-3">
    <div class="row mb-2">
      <div class="col-7 me-auto">
        <div class="row align-items-center">
          <label class="col-auto" for="customGear">Load setup:</label>
          <ng-select
            class="col"
            labelForId="customGear"
            [(ngModel)]="selectedGearSetupPreset"
            [clearable]="false"
            (change)="loadGearSetup($event)"
          >
            <ng-option *ngFor="let gearSetup of gearSetupPresets | keyvalue" [value]="gearSetup.key">{{
              gearSetup.key
            }}</ng-option>
          </ng-select>
        </div>
      </div>
      <div class="col-auto">
        <button type="button" class="btn btn-primary" (click)="duplicateGearSetup()">
          Duplicate <i class="bi bi-clipboard-plus"></i>
        </button>
      </div>
    </div>
    <div class="row">
      <div class="col-7 me-auto">
        <button type="button" class="btn btn-primary w-100" (click)="loadRlGear()">Load RL gear</button>
      </div>
      <div class="col-auto">
        <button type="button" class="btn btn-danger" (click)="removeGearSetup()">Remove gear setup</button>
      </div>
    </div>
  </div>

  <div class="row mb-3" *ngIf="allGearSlotItems">
    <div class="row mb-2 align-items-center" *ngFor="let slot of allGearSlots">
      <div class="col-1 pe-0 d-flex justify-content-center">
        <ng-container *ngIf="gearInputSetup.gear[slot]; else placeholder">
          <img src="data:image/png;base64,{{ gearInputSetup.gear[slot].icon }}" />
        </ng-container>
        <ng-template #placeholder><img src="assets/img/equip/slot_{{ slot }}.png" /></ng-template>
      </div>

      <div class="col">
        <ng-select
          (change)="gearSlotChange($event, slot)"
          [items]="allGearSlotItems[slot]"
          [(ngModel)]="gearInputSetup.gear[slot]"
          bindLabel="name"
        >
          <ng-template ng-label-tmp let-item="item">{{ item.name }}</ng-template>
          <ng-template ng-option-tmp let-item="item">
            <div class="d-flex flex-row align-items-center">
              <div class="text-center" style="flex: 0 0 35px">
                <img src="data:image/png;base64,{{ item.icon }}" />
              </div>
              <div class="ps-2">{{ item.name }}</div>
            </div>
          </ng-template>
        </ng-select>
      </div>

      <div class="col-5" *ngIf="gearInputSetup.gear[slot]?.id == BLOWPIPE_ID">
        <ng-select [(ngModel)]="selectedDart" [clearable]="false">
          <ng-option *ngFor="let dart of allDarts" [value]="dart">{{ dart.name }}</ng-option>
        </ng-select>
      </div>

      <div class="col-auto" *ngIf="slot === GearSlot.Weapon && specialGear.isSpecialWeapon">
        <div class="row align-items-center">
          <div class="col-auto text-end ps-4">
            <label for="useSpecialAttack">Special attack</label>
          </div>
          <div class="col-auto">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="gearInputSetup.isSpecial"
              id="useSpecialAttack"
              (change)="gearInputSetup.isFill = gearInputSetup.isSpecial"
            />
          </div>
        </div>
      </div>
      <div class="col-auto" *ngIf="slot === GearSlot.Head && specialGear.isSlayerHelm">
        <div class="row align-items-center">
          <div class="col-auto text-end"><label for="isOnSlayerTask">Slayer task</label></div>
          <div class="col-auto">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="gearInputSetup.isOnSlayerTask"
              id="isOnSlayerTask"
            />
          </div>
        </div>
      </div>
      <div class="col-auto" *ngIf="slot === GearSlot.Weapon && specialGear.isWildernessWeapon">
        <div class="row align-items-center">
          <div class="col-auto text-end"><label for="isInWilderness">Wilderness</label></div>
          <div class="col-auto">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="gearInputSetup.isInWilderness"
              id="isInWilderness"
            />
          </div>
        </div>
      </div>
      <div class="col-6" *ngIf="slot === GearSlot.Weapon && specialGear.isDharokSet">
        <div class="row align-items-center justify-content-end">
          <div class="col-auto"><img src="assets/img/skills/hitpoints.png" /></div>
          <div class="col-4">
            <input
              class="form-control"
              type="number"
              [(ngModel)]="gearInputSetup.currentHp"
              max="99"
              min="1"
              id="currentHp"
            />
          </div>
          <div class="col-1">/</div>
          <div class="col-4">
            <input
              class="form-control"
              type="number"
              [(ngModel)]="this.gearInputSetup.combatStats.hitpoints"
              max="99"
              min="1"
              id="maxHp"
            />
          </div>
        </div>
      </div>
      <div class="col-3" *ngIf="slot === GearSlot.Weapon && gearInputSetup.gear[slot]?.name.includes('pickaxe')">
        <div class="row align-items-center justify-content-end">
          <div class="col-3"><img src="assets/img/skills/mining.png" /></div>
          <div class="col-9">
            <input
              class="form-control"
              type="number"
              [(ngModel)]="gearInputSetup.miningLvl"
              max="99"
              min="1"
              id="miningLvl"
            />
          </div>
        </div>
      </div>
      <div class="col-auto" *ngIf="slot === GearSlot.Ammo && specialGear.isSpecialBolt">
        <div class="row align-items-center justify-content-end">
          <div class="col-auto text-end"><label for="isKandarinDiary">Kandarin diary</label></div>
          <div class="col-auto">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="gearInputSetup.isKandarinDiary"
              id="isKandarinDiary"
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="row mb-3 align-items-center">
      <div class="col-3"><label for="attackStyle">Attack style</label></div>
      <div class="col-9">
        <ng-select [(ngModel)]="gearInputSetup.attackStyle" (change)="gearInputSetup.spell = null">
          <ng-option *ngFor="let style of attackStyles" [value]="style">{{ style }}</ng-option>
        </ng-select>
      </div>
    </div>

    <div class="row mb-3 align-items-center">
      <div class="col-3"><label for="attackStyle">Spell</label></div>
      <div class="col-9">
        <ng-select [items]="allSpells" [(ngModel)]="gearInputSetup.spell" (change)="selectedSpellChange()">
          <ng-template ng-option-tmp ng-label-tmp let-item="item" let-index="index">
            <div class="row">
              <div class="col-1"><img src="assets/img/magic_spells/{{ item }}.png" /></div>
              <div class="col-auto">{{ item }}</div>
            </div>
          </ng-template>
        </ng-select>
      </div>
    </div>

    <div class="row mb-3 align-items-center">
      <div class="col-3"><label>Prayers</label></div>
      <div class="col">
        <div class="row justify-content-between">
          <div *ngFor="let prayer of allPrayers" class="col-auto">
            <div *ngIf="!gearInputSetup.prayers.includes(prayer); else selectedPrayer">
              <img src="assets/img/prayer/{{ prayer }}.png" (click)="addPrayer(prayer)" />
            </div>
            <ng-template #selectedPrayer>
              <img src="assets/img/prayer/selected_{{ prayer }}.png" (click)="removePrayer(prayer)" />
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-3 align-items-center">
      <div class="col-3"><label>Combat Stats</label></div>
      <div class="col" *ngFor="let skill of skills">
        <div class="row align-items-center">
          <div class="col-3">
            <img src="assets/img/skills/{{ skill }}.png" />
          </div>
          <div class="col">
            <input
              class="form-control"
              type="number"
              [(ngModel)]="gearInputSetup.combatStats[skill]"
              max="99"
              min="1"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-3 align-items-center">
      <div class="col-3"><label>Boosts</label></div>
      <div class="col">
        <app-boost-selection
          [selectedBoosts]="gearInputSetup.boosts"
          (boostAdded)="addBoost($event)"
          (boostRemoved)="removeBoost($event)"
        ></app-boost-selection>
      </div>
    </div>

    <div class="row mb-3 align-items-center justify-content-start">
      <div class="col-3"><label>Other</label></div>
      <div class="col-auto text-end"><label for="isFill">Fill weapon</label></div>
      <div class="col-auto">
        <input
          class="form-check-input"
          type="checkbox"
          [(ngModel)]="gearInputSetup.isFill"
          id="isFill"
          [disabled]="gearInputSetup.isSpecial"
        />
      </div>
    </div>
    <div class="row mb-3">
      <app-condition
        [initialConditions]="gearInputSetup.conditions"
        [isFill]="gearInputSetup.isFill"
        (conditionsChanged)="updateConditions($event)"
      ></app-condition>
    </div>
  </div>
</div>
